<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ELITE NOTES</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700;900&family=Montserrat:wght@300;400;600;700&display=swap');

    :root{
      --bg1:#070A14;
      --bg2:#0C1430;
      --bg3:#0A2A4A;

      --glass: rgba(255,255,255,0.06);
      --glass2: rgba(255,255,255,0.09);
      --stroke: rgba(255,255,255,0.14);

      --gold1:#f6e3b0;
      --gold2:#d4af37;
      --gold3:#8b6914;

      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.62);

      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --shadowSoft: 0 12px 28px rgba(0,0,0,.25);

      --r-xl: 30px;
      --r-lg: 22px;
      --r-md: 16px;
    }

    *{ margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    body{
      min-height:100vh;
      font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      padding: 18px;
      background:
        radial-gradient(900px 650px at 78% 8%, rgba(212,175,55,0.20), transparent 60%),
        radial-gradient(800px 600px at 12% 18%, rgba(170,120,255,0.18), transparent 60%),
        linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 55%, var(--bg3) 100%);
      overflow-x:hidden;
    }
    body::before{
      content:"";
      position: fixed; inset:0; pointer-events:none;
      background:
        radial-gradient(260px 260px at 15% 72%, rgba(255,255,255,0.05), transparent 65%),
        radial-gradient(220px 220px at 75% 64%, rgba(255,255,255,0.04), transparent 65%),
        radial-gradient(280px 280px at 85% 28%, rgba(255,255,255,0.05), transparent 65%);
      opacity:.9;
    }

    .save-indicator{
      position: fixed; top: 14px; right: 14px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(10,10,18,0.72);
      border: 1px solid rgba(212,175,55,0.30);
      box-shadow: var(--shadowSoft);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      opacity:0;
      transform: translateY(-6px);
      transition: .25s ease;
      pointer-events:none;
      z-index: 1000;
      font-weight: 700;
      display:flex; gap:8px; align-items:center;
    }
    .save-indicator::before{ content:"‚ú¶"; color: var(--gold2); }
    .save-indicator.show{ opacity:1; transform: translateY(0); }

    .app{
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
    }

    .hero{
      text-align:center;
      margin: 6px 0 14px;
    }
    .hero h1{
      font-family: 'Playfair Display', serif;
      font-weight: 900;
      letter-spacing: 2px;
      font-size: clamp(30px, 4.6vw, 52px);
      background: linear-gradient(135deg, var(--gold2) 0%, var(--gold1) 48%, var(--gold3) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .hero .sub{
      margin-top: 4px;
      color: var(--muted);
      font-weight: 500;
    }

    /* 3 oszlopos ‚Äúk√©pes‚Äù layout */
    .shell{
      background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06));
      border: 1px solid var(--stroke);
      border-radius: var(--r-xl);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
      position: relative;
    }
    .shell::after{
      content:"";
      position:absolute; inset:-1px; pointer-events:none;
      background:
        linear-gradient(135deg, rgba(212,175,55,0.22), rgba(255,255,255,0) 35%),
        linear-gradient(315deg, rgba(212,175,55,0.16), rgba(255,255,255,0) 40%);
      opacity:.6; mix-blend-mode: screen;
    }

    .layout{
      position: relative;
      z-index: 1;
      display:grid;
      grid-template-columns: 300px 1fr 420px;
      gap: 14px;
      padding: 14px;
    }

    .panel{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: var(--r-lg);
      box-shadow: var(--shadowSoft);
      overflow:hidden;
    }

    .panel-header{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
    }
    .panel-title{
      font-size: 12px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.75);
      font-weight: 700;
    }

    .panel-body{ padding: 12px 14px; }

    /* Notebook grid (k√∂z√©ps≈ë) */
    .notebooks-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }

    .nb-card{
      position: relative;
      padding: 16px;
      border-radius: 20px;
      cursor:pointer;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 12px 30px rgba(0,0,0,.22);
      transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
      overflow:hidden;
    }
    .nb-card::after{
      content:"";
      position:absolute; inset:10px;
      border-radius: 14px;
      border: 2px solid rgba(212,175,55,0.45);
      opacity:.8;
      pointer-events:none;
    }
    .nb-card:hover{
      transform: translateY(-2px);
      border-color: rgba(212,175,55,0.28);
      box-shadow: 0 18px 40px rgba(0,0,0,.30);
    }
    .nb-emoji{
      width:56px; height:56px;
      border-radius: 18px;
      display:flex; align-items:center; justify-content:center;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.14);
      font-size: 28px;
    }
    .nb-name{ font-weight: 800; }
    .nb-meta{ margin-top: 6px; color: var(--muted); font-size: 12px; }

    /* Noter tabs (bal) */
    .tabs{
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    .tab-search{
      display:flex;
      gap: 8px;
      align-items:center;
    }
    .search{
      width:100%;
      padding: 11px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.9);
      outline:none;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
    }
    .search::placeholder{ color: rgba(255,255,255,0.45); }

    .tab-item{
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      cursor:pointer;
      transition: transform .14s ease, border-color .14s ease;
      display:flex; justify-content: space-between; gap: 10px;
    }
    .tab-item:hover{ transform: translateY(-1px); border-color: rgba(212,175,55,0.22); }
    .tab-item.active{
      border-color: rgba(212,175,55,0.42);
      background: rgba(212,175,55,0.12);
    }
    .tab-title{
      font-weight: 800;
      font-size: 13px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .tab-sub{ margin-top: 3px; font-size: 12px; color: var(--muted); }
    .pill{
      align-self:flex-start;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 800;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.75);
      flex: 0 0 auto;
    }
    .pill.gold{
      border-color: rgba(212,175,55,0.35);
      background: rgba(212,175,55,0.12);
      color: rgba(246,227,176,0.98);
    }

    /* Editor (jobb) */
    .editor-tabs{
      display:flex;
      gap: 10px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 999px;
      padding: 6px;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
    }
    .editor-tab{
      flex:1;
      text-align:center;
      padding: 10px 10px;
      border-radius: 999px;
      font-weight: 900;
      cursor:pointer;
      color: rgba(255,255,255,0.75);
    }
    .editor-tab.active{
      color: rgba(255,255,255,0.92);
      border: 1px solid rgba(212,175,55,0.28);
      background: linear-gradient(135deg, rgba(246,227,176,0.32), rgba(212,175,55,0.18), rgba(139,105,20,0.22));
    }

    .editor-content{ display:none; margin-top: 12px; }
    .editor-content.active{ display:block; }

    .input-title, .input-text{
      width:100%;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.9);
      outline:none;
      border-radius: 16px;
      padding: 12px 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.16);
    }
    .input-title{ font-weight: 900; margin-bottom: 10px; }
    .input-text{ min-height: 320px; resize: vertical; line-height: 1.55; }
    .input-title:focus, .input-text:focus{ border-color: rgba(212,175,55,0.40); }

    #drawingCanvas{
      width: 100%;
      height: 420px;
      background: rgba(255,255,255,0.98);
      border-radius: 18px;
      border: 1px solid rgba(212,175,55,0.40);
      box-shadow: 0 14px 40px rgba(0,0,0,.22);
      touch-action:none;
    }

    .toolbar{
      display:flex; gap: 10px; align-items:center; flex-wrap: wrap;
      margin-bottom: 10px;
    }

    /* Gombok */
    .btn{
      border:none;
      cursor:pointer;
      border-radius: 999px;
      padding: 11px 16px;
      font-weight: 900;
      letter-spacing: .2px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
      -webkit-user-select:none;
      white-space: nowrap;
    }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      background: linear-gradient(135deg, var(--gold1) 0%, var(--gold2) 42%, var(--gold3) 100%);
      color: rgba(10,10,18,0.92);
      box-shadow: 0 18px 42px rgba(212,175,55,.18);
    }
    .btn-ghost{
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.14);
      color: rgba(255,255,255,0.9);
      box-shadow: 0 10px 24px rgba(0,0,0,.16);
    }
    .btn-danger{
      background: rgba(231,76,60,0.14);
      border: 1px solid rgba(231,76,60,0.45);
      color: rgba(255,255,255,0.92);
    }

    .bottom-action{
      display:flex;
      justify-content:center;
      padding: 14px;
    }
    .bottom-action .btn{
      width: min(520px, 100%);
      padding: 14px 18px;
      font-size: 14px;
    }

    .empty{
      padding: 18px;
      text-align:center;
      color: rgba(255,255,255,0.72);
      border: 1px dashed rgba(255,255,255,0.18);
      border-radius: 18px;
      background: rgba(255,255,255,0.05);
    }

    /* mobil t√∂r√©s */
    @media (max-width: 1100px){
      .layout{ grid-template-columns: 280px 1fr 380px; }
    }
    @media (max-width: 980px){
      .layout{
        grid-template-columns: 1fr;
      }
      #drawingCanvas{ height: 380px; }
    }
  </style>
</head>

<body>
  <div class="save-indicator" id="saveIndicator"><span id="saveText">Mentve</span></div>

  <div class="app">
    <div class="hero">
      <h1>PLAFIR NOTES</h1>
      <div class="sub">Luxus jegyzetf√ºzet ‚Ä¢ offline ment√©s</div>
    </div>

    <div class="shell">
      <div class="layout">

        <!-- BAL: NOTER TABS -->
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Noter tabs</div>
          </div>
          <div class="panel-body">
            <div class="tab-search" style="margin-bottom:10px;">
              <input class="search" id="noteSearch" placeholder="Keres√©s c√≠mre..." oninput="renderTabs()" />
            </div>
            <div id="tabsList" class="tabs"></div>
          </div>
        </div>

        <!-- K√ñZ√âP: NOTEBOOKS GRID / NOTES LIST -->
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title" id="centerTitle">Notebooks grid</div>
            <button class="btn btn-ghost" onclick="centerPrimaryAction()" id="centerActionBtn">‚úö √öj f√ºzet</button>
          </div>

          <div class="panel-body">
            <div id="notebooksPage" class="page active">
              <div id="notebooksList" class="notebooks-grid"></div>
            </div>

            <div id="notesPage" class="page">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px;">
                <div style="font-weight:900;" id="currentNotebookName">F√ºzet</div>
                <button class="btn btn-danger" onclick="deleteNotebook()">üóë</button>
              </div>
              <div id="notesList"></div>
              <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
                <button class="btn btn-primary" onclick="openNewNoteModal()">‚úö √öj jegyzet</button>
                <button class="btn btn-ghost" onclick="showNotebooksPage()">‚¨Ö F√ºzetek</button>
              </div>
            </div>

          </div>
        </div>

        <!-- JOBB: EDITOR -->
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Editor</div>
            <button class="btn btn-ghost" onclick="backToNotes()">‚¨Ö List√°hoz</button>
          </div>

          <div class="panel-body">
            <div id="editorPage" class="page active">
              <div class="editor-tabs">
                <div class="editor-tab active" data-type="text" onclick="switchEditorTab('text')">G√©pel√©s</div>
                <div class="editor-tab" data-type="drawing" onclick="switchEditorTab('drawing')">Rajz</div>
              </div>

              <div id="textEditor" class="editor-content active">
                <input id="noteTitle" class="input-title" placeholder="C√≠m..." />
                <textarea id="noteText" class="input-text" placeholder="√çrj ide valamit..."></textarea>
              </div>

              <div id="drawingEditor" class="editor-content">
                <input id="drawingTitle" class="input-title" placeholder="Rajz c√≠me..." />
                <div class="toolbar">
                  <button class="btn btn-ghost" onclick="clearCanvas()">‚ü≤ T√∂rl√©s</button>
                  <span class="pill gold">Sz√≠n</span>
                  <input type="color" id="colorPicker" value="#000000"
                    style="width:44px;height:38px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.06);padding:4px;" />
                </div>
                <canvas id="drawingCanvas"></canvas>
              </div>

              <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
                <button class="btn btn-primary" onclick="saveNote()">üíæ Ment√©s</button>
                <button class="btn btn-danger" onclick="deleteNote()">üóë T√∂rl√©s</button>
              </div>

              <div class="empty" id="editorHint" style="margin-top:12px; display:none;">
                V√°lassz egy jegyzetet balr√≥l, vagy k√©sz√≠ts √∫jat a k√∂z√©ps≈ë panelen.
              </div>
            </div>
          </div>
        </div>

      </div>

      <div class="bottom-action">
        <button class="btn btn-primary" onclick="globalPrimary()">‚úö √öj f√ºzet / jegyzet</button>
      </div>
    </div>
  </div>

  <script>
    let notebooks = JSON.parse(localStorage.getItem('elite_nb')) || [];
    let notes = JSON.parse(localStorage.getItem('elite_notes')) || [];
    let currentNotebookId = null;
    let currentNoteId = null;
    let currentEditorType = 'text';

    let canvas, ctx, isDrawing = false;

    window.onload = () => {
      initCanvas();
      renderNotebooks();
      showNotebooksPage();
      renderTabs();
      refreshCenterHeader();
      refreshEditorHint();
    };

    function saveData() {
      localStorage.setItem('elite_nb', JSON.stringify(notebooks));
      localStorage.setItem('elite_notes', JSON.stringify(notes));
      const ind = document.getElementById('saveIndicator');
      ind.classList.add('show');
      setTimeout(() => ind.classList.remove('show'), 1000);
    }

    /* ===== UI ROUTING (center panel pages) ===== */
    function showPage(id) {
      document.querySelectorAll('#notebooksPage, #notesPage').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      refreshCenterHeader();
      renderTabs();
      refreshEditorHint();
    }

    function refreshCenterHeader(){
      const title = document.getElementById('centerTitle');
      const btn = document.getElementById('centerActionBtn');
      const inNotes = document.getElementById('notesPage').classList.contains('active');

      if(!inNotes){
        title.textContent = 'Notebooks grid';
        btn.textContent = '‚úö √öj f√ºzet';
      }else{
        title.textContent = 'Notebook notes';
        btn.textContent = '‚úö √öj jegyzet';
      }
    }

    function centerPrimaryAction(){
      const inNotes = document.getElementById('notesPage').classList.contains('active');
      if(!inNotes) openNewNotebookModal();
      else openNewNoteModal();
    }

    function globalPrimary(){
      // ha van megnyitott f√ºzet -> √∫j jegyzet, k√ºl√∂nben √∫j f√ºzet
      if(currentNotebookId) openNewNoteModal();
      else openNewNotebookModal();
    }

    /* ===== NOTEBOOKS ===== */
    function renderNotebooks() {
      const list = document.getElementById('notebooksList');
      if (notebooks.length === 0) {
        list.innerHTML = '<div class="empty">Nincs m√©g f√ºzeted. Nyomj az <b>√öj f√ºzet</b> gombra ‚ú®</div>';
        return;
      }
      list.innerHTML = notebooks.map(nb => {
        const count = notes.filter(n => n.notebookId === nb.id).length;
        return `
          <div class="nb-card" onclick="openNotebook('${nb.id}')">
            <div class="nb-emoji">üìí</div>
            <div class="nb-name">${escapeHtml(nb.name)}</div>
            <div class="nb-meta">${count} jegyzet</div>
          </div>
        `;
      }).join('');
    }

    function openNewNotebookModal() {
      const n = prompt("F√ºzet neve:");
      if (n) {
        notebooks.push({id: 'nb'+Date.now(), name: n});
        saveData();
        renderNotebooks();
        showNotebooksPage();
      }
    }

    function openNotebook(id) {
      currentNotebookId = id;
      const nb = notebooks.find(x => x.id === id);
      document.getElementById('currentNotebookName').textContent = nb ? nb.name : 'F√ºzet';
      showPage('notesPage');
      renderNotes();
      renderTabs();
    }

    function deleteNotebook() {
      if(!currentNotebookId) return;
      if(confirm("Biztos t√∂rl√∂d?")) {
        notebooks = notebooks.filter(x => x.id !== currentNotebookId);
        notes = notes.filter(x => x.notebookId !== currentNotebookId);
        currentNotebookId = null;
        currentNoteId = null;
        saveData();
        renderNotebooks();
        showNotebooksPage();
        renderTabs();
        refreshEditorHint();
      }
    }

    function showNotebooksPage() {
      showPage('notebooksPage');
      renderNotebooks();
    }

    /* ===== NOTES ===== */
    function renderNotes() {
      const list = document.getElementById('notesList');
      const filtered = notes.filter(n => n.notebookId === currentNotebookId);
      if (filtered.length === 0) {
        list.innerHTML = '<div class="empty">Ebben a f√ºzetben m√©g nincs jegyzet.</div>';
        return;
      }
      list.innerHTML = filtered.map(n => `
        <div class="tab-item" onclick="editNote('${n.id}')">
          <div style="min-width:0;">
            <div class="tab-title">${escapeHtml(n.title || 'C√≠m n√©lk√ºl')}</div>
            <div class="tab-sub">${n.type === 'text' ? 'Sz√∂veges' : 'Rajz'}</div>
          </div>
          ${n.type === 'text' ? '<span class="pill">text</span>' : '<span class="pill gold">draw</span>'}
        </div>
      `).join('');
    }

    function openNewNoteModal() {
      if(!currentNotebookId){
        alert("El≈ëbb v√°la

        // ===== APP STATE =====
        let notebooks = [];
        let notes = [];
        let currentNotebookId = null;
        let currentNoteId = null;
        let currentEditorType = 'text';
        let autoSaveTimeout = null;

        // Rajz √°llapot
        let canvas = null;
        let ctx = null;
        let isDrawing = false;
        let currentTool = 'pen';
        let currentColor = '#000000';
        let currentStrokeWidth = 4;
        let lastX = 0;
        let lastY = 0;

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderNotebooks();
            initCanvas();
        });

        // ===== LOCAL STORAGE =====
        function loadData() {
            notebooks = JSON.parse(localStorage.getItem('elite_notes_notebooks')) || [];
            notes = JSON.parse(localStorage.getItem('elite_notes_notes')) || [];
        }

        function saveData() {
            localStorage.setItem('elite_notes_notebooks', JSON.stringify(notebooks));
            localStorage.setItem('elite_notes_notes', JSON.stringify(notes));
            showSaveIndicator('üíæ Mentve');
        }

        function showSaveIndicator(text) {
            const indicator = document.getElementById('saveIndicator');
            const textEl = document.getElementById('saveText');
            textEl.textContent = text;
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 1500);
        }

        // ===== NOTEBOOKS NAVIG√ÅCI√ì =====
        function renderNotebooks() {
            const container = document.getElementById('notebooksList');
            
            if (notebooks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <p>M√©g nincsenek f√ºzeteid</p>
                        <p style="font-size: 13px; margin-top: 10px;">Hozz l√©tre egy √∫j f√ºzetet az al√°bbi gomb megnyom√°s√°val!</p>
                    </div>
                `;
                return;
            }

            let html = '';
            notebooks.forEach(notebook => {
                const notebookNotes = notes.filter(n => n.notebookId === notebook.id);
                html += `
                    <div class="notebook-card" onclick="openNotebook('${notebook.id}')">
                        <div class="notebook-icon">${notebook.icon || 'üìí'}</div>
                        <div class="notebook-name">${notebook.name}</div>
                        <div class="notebook-count">${notebookNotes.length} jegyzet</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function openNewNotebookModal() {
            const name = prompt('Add meg az √∫j f√ºzet nev√©t:');
            if (name && name.trim() !== "") {
                const newNotebook = {
                    id: 'nb_' + Date.now(),
                    name: name,
                    icon: 'üìí',
                    createdAt: new Date().toISOString()
                };
                notebooks.push(newNotebook);
                saveData();
                renderNotebooks();
            }
        }

        function openNotebook(id) {
            currentNotebookId = id;
            const notebook = notebooks.find(nb => nb.id === id);
            document.getElementById('currentNotebookName').textContent = notebook.name;
            
            showPage('notesPage');
            renderNotes();
        }

        function deleteNotebook() {
            if (confirm('Biztosan t√∂rl√∂d ezt a f√ºzetet az √∂sszes jegyzettel egy√ºtt?')) {
                notebooks = notebooks.filter(nb => nb.id !== currentNotebookId);
                notes = notes.filter(n => n.notebookId !== currentNotebookId);
                saveData();
                showNotebooksPage();
            }
        }

        // ===== NOTES NAVIG√ÅCI√ì =====
        function renderNotes() {
            const container = document.getElementById('notesList');
            const filteredNotes = notes.filter(n => n.notebookId === currentNotebookId);

            if (filteredNotes.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Ebben a f√ºzetben m√©g nincs jegyzet.</p></div>';
                return;
            }

            let html = '';
            filteredNotes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)).forEach(note => {
                html += `
                    <div class="note-item" onclick="editNote('${note.id}')">
                        <div class="note-content">
                            <div class="note-title">${note.title || 'C√≠m n√©lk√ºl'}</div>
                            <div class="note-preview">${note.type === 'text' ? (note.content || 'Nincs tartalom') : 'üé® Rajzolt jegyzet'}</div>
                            <div class="note-date">${new Date(note.updatedAt).toLocaleDateString('hu-HU')}</div>
                        </div>
                        <div class="note-type-badge ${note.type}">${note.type === 'text' ? 'TEXT' : 'DRAW'}</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function openNewNoteModal() {
            currentNoteId = 'note_' + Date.now();
            currentEditorType = 'text';
            
            // Alaphelyzetbe √°ll√≠t√°s
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteText').value = '';
            document.getElementById('drawingTitle').value = '';
            clearCanvas();
            
            switchEditorTab('text');
            showPage('editorPage');
        }

        function editNote(id) {
            const note = notes.find(n => n.id === id);
            currentNoteId = id;
            currentEditorType = note.type;

            if (note.type === 'text') {
                document.getElementById('noteTitle').value = note.title;
                document.getElementById('noteText').value = note.content;
                switchEditorTab('text');
            } else {
                document.getElementById('drawingTitle').value = note.title;
                const img = new Image();
                img.onload = () => {
                    clearCanvas();
                    ctx.drawImage(img, 0, 0);
                };
                img.src = note.content;
                switchEditorTab('drawing');
            }
            showPage('editorPage');
        }

        function saveNote() {
            const isText = currentEditorType === 'text';
            const title = isText ? document.getElementById('noteTitle').value : document.getElementById('drawingTitle').value;
            const content = isText ? document.getElementById('noteText').value : canvas.toDataURL();

            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            const noteData = {
                id: currentNoteId,
                notebookId: currentNotebookId,
                title: title || 'C√≠m n√©lk√ºl',
                content: content,
                type: currentEditorType,
                updatedAt: new Date().toISOString()
            };

            if (noteIndex > -1) {
                notes[noteIndex] = noteData;
            } else {
                notes.push(noteData);
            }

            saveData();
            backToNotes();
        }

        function deleteNote() {
            if (confirm('Biztosan t√∂rl√∂d ezt a jegyzetet?')) {
                notes = notes.filter(n => n.id !== currentNoteId);
                saveData();
                backToNotes();
            }
        }

        // ===== EDITOR FUNKCI√ìK =====
        function switchEditorTab(type) {
            currentEditorType = type;
            document.querySelectorAll('.editor-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.type === type);
            });
            document.getElementById('textEditor').classList.toggle('active', type === 'text');
            document.getElementById('drawingEditor').classList.toggle('active', type === 'drawing');
            
            if (type === 'drawing') {
                resizeCanvas();
            }
        }

        function autoSaveNote() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                // Csak jelz√©s, a t√©nyleges ment√©s a Ment√©s gombra t√∂rt√©nik, 
                // de itt is implement√°lhat√≥ a saveData() h√≠v√°sa ha szeretn√©d
                console.log('Auto-save trigger...');
            }, 1000);
        }

        // ===== RAJZ FUNKCI√ìK =====
        function initCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // √ârint≈ëk√©perny≈ë t√°mogat√°s
            canvas.addEventListener('touchstart', (e) => {
                const touch = e.touches[0];
                startDrawing({ offsetX: touch.clientX - canvas.getBoundingClientRect().left, offsetY: touch.clientY - canvas.getBoundingClientRect().top });
            });
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                draw({ offsetX: touch.clientX - canvas.getBoundingClientRect().left, offsetY: touch.clientY - canvas.getBoundingClientRect().top });
            });
            canvas.addEventListener('touchend', stopDrawing);
        }

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = 500;
        }

        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function draw(e) {
            if (!isDrawing) return;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.strokeStyle = currentTool === 'eraser' ? '#FFFFFF' : currentColor;
            ctx.lineWidth = currentStrokeWidth;
            ctx.lineCap = 'round';
            ctx.stroke();
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function stopDrawing() { isDrawing = false; }
        function selectTool(tool) {
            currentTool = tool;
            document.querySelectorAll('[data-tool]').forEach(btn => btn.classList.toggle('active', btn.dataset.tool === tool));
        }
        function changeColor() { currentColor = document.getElementById('colorPicker').value; selectTool('pen'); }
        function changeStrokeWidth() { currentStrokeWidth = document.getElementById('strokeWidth').value; }
        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

        // ===== OLDAL KEZEL√âS =====
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0,0);
        }

        function showNotebooksPage() {
            renderNotebooks();
            showPage('notebooksPage');
        }

        function backToNotes() {
            renderNotes();
            showPage('notesPage');
        }
    </script>
</body>
</html>

